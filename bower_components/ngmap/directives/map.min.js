(function(){function a(d,c){var e;if(d.currentStyle){e=d.currentStyle[c]}else{if(window.getComputedStyle){e=document.defaultView.getComputedStyle(d,null).getPropertyValue(c)}}return e}var b=function(e,d,f){var g=e;var c=function(r,m,q,h){var j=g.orgAttributes(m);r.google=google;var k=document.createElement("div");k.style.width="100%";k.style.height="100%";m.prepend(k);if(q.defaultStyle!=="false"){if(a(m[0],"display")!="block"){m.css("display","block")}if(a(m[0],"height").match(/^(0|auto)/)){m.css("height","300px")}}m[0].addEventListener("dragstart",function(t){t.preventDefault();return false});var i=function(v,x){var w=new google.maps.Map(k,{});w.markers={};w.shapes={};d(function(){google.maps.event.trigger(w,"resize")});v.zoom=v.zoom||15;var t=v.center;if(!t){v.center=new google.maps.LatLng(0,0)}else{if(!(t instanceof google.maps.LatLng)){delete v.center;h.getGeoLocation(t).then(function(z){w.setCenter(z);var y=q.geoCallback;y&&f(y)(r)},function(y){w.setCenter(s.geoFallbackCenter)})}}w.setOptions(v);for(var u in x){if(u){google.maps.event.addListener(w,u,x[u])}}h.observeAttrSetObj(j,q,w);h.map=w;h.addObjects(h._objects);r.map=w;r.map.scope=r;google.maps.event.addListenerOnce(w,"idle",function(){r.$emit("mapInitialized",w);if(q.zoomToIncludeMarkers){h.zoomToIncludeMarkers();if(q.zoomToIncludeMarkers=="auto"){r.$on("objectChanged",function(y,z){z[0]=="markers"&&h.zoomToIncludeMarkers()})}}})};var n=g.filter(q);var s=g.getOptions(n,r);var p=g.getControlOptions(n);var l=angular.extend(s,p);var o=g.getEvents(r,n);console.log("filtered",n,"mapOptions",l,"mapEvents",o);if(q.initEvent){r.$on(q.initEvent,function(){!h.map&&i(l,o)})}else{i(l,o)}};return{restrict:"AE",controller:"MapController",link:c}};angular.module("ngMap").directive("map",["Attr2Options","$timeout","$parse",b])})();