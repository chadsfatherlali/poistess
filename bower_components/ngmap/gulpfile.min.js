"use strict";var gulp=require("gulp");var concat=require("gulp-concat");var uglify=require("gulp-uglify");var debug=require("gulp-debug");var rename=require("gulp-rename");var stripDebug=require("gulp-strip-debug");var gutil=require("gulp-util");var clean=require("gulp-clean");var runSequence=require("run-sequence");var gutil=require("gulp-util");var through=require("through2");var replace=require("gulp-replace");var tap=require("gulp-tap");var bump=require("gulp-bump");var shell=require("gulp-shell");var karma=require("karma").server;var connect=require("gulp-connect");var gulpProtractor=require("gulp-protractor").protractor;var angularJsdoc=require("angular-jsdoc");var bumpVersion=function(b){b=b||"patch";var a="";gulp.src(["./bower.json","./package.json"]).pipe(bump({type:b})).pipe(gulp.dest("./")).pipe(tap(function(d,c){a=JSON.parse(d.contents.toString()).version})).on("end",function(){var c=gutil.colors;gulp.src("").pipe(shell(['git commit --all --message "Version '+a+'"',(b!="patch"?'git tag --annotate "v'+a+'" --message "Version '+a+'"':"true")],{ignoreErrors:false})).pipe(tap(function(){gutil.log(c.green("Version bumped to ")+c.yellow(a)+c.green(", don't forget to push!"))}))})};gulp.task("clean",function(){return gulp.src("build").pipe(clean({force:true}))});gulp.task("build-js",function(){return gulp.src(["app.js","services/*.js","directives/*.js"]).pipe(concat("ng-map.debug.js")).pipe(gulp.dest("build/scripts")).pipe(stripDebug()).pipe(concat("ng-map.js")).pipe(gulp.dest("build/scripts")).pipe(uglify()).pipe(rename("ng-map.min.js")).pipe(gulp.dest("build/scripts")).on("error",gutil.log)});gulp.task("docs",function(){gulp.task("docs",shell.task(["node_modules/jsdoc/jsdoc.js -c node_modules/angular-jsdoc/common/conf.json -t node_modules/angular-jsdoc/angular-template -d build/docs ./README.md -r directives services"]))});gulp.task("bump",function(){bumpVersion("patch")});gulp.task("bump:patch",function(){bumpVersion("patch")});gulp.task("bump:minor",function(){bumpVersion("minor")});gulp.task("bump:major",function(){bumpVersion("major")});gulp.task("build",function(a){runSequence("clean","build-js","test","docs",a)});gulp.task("test",function(a){karma.start({configFile:__dirname+"/config/karma.conf.js",singleRun:true},a)});gulp.task("testapp-server",function(){connect.server({root:__dirname+"/testapp",port:8888})});gulp.task("test-e2e",["testapp-server"],function(){gulp.src([__dirname+"/spec/e2e/*_spec.js"]).pipe(gulpProtractor({configFile:__dirname+"/config/protractor.conf.js",args:["--baseUrl","http://localhost:8888"]})).on("error",function(a){console.log(["------------------------------------------------------------------------------------","For first-time user, we need to update webdrivers","$ node_modules/gulp-protractor/node_modules/protractor/bin/webdriver-manager update","------------------------------------------------------------------------------------"].join("\n"));throw a}).on("end",function(){connect.serverClose()})});