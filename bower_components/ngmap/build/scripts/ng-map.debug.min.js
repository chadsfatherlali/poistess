angular.module("ngMap",[]);(function(){var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g;var MOZ_HACK_REGEXP=/^moz([A-Z])/;function camelCase(name){return name.replace(SPECIAL_CHARS_REGEXP,function(_,separator,letter,offset){return offset?letter.toUpperCase():letter}).replace(MOZ_HACK_REGEXP,"Moz$1")}function JSONize(str){try{JSON.parse(str);return str}catch(e){return str.replace(/([\$\w]+)\s*:/g,function(_,$1){return'"'+$1+'":'}).replace(/'([^']+)'/g,function(_,$1){return'"'+$1+'"'})}}var Attr2Options=function($parse,$timeout,NavigatorGeolocation,GeoCoder){var orgAttributes=function(el){(el.length>0)&&(el=el[0]);var orgAttributes={};for(var i=0;i<el.attributes.length;i++){var attr=el.attributes[i];orgAttributes[attr.name]=attr.value}return orgAttributes};var toOptionValue=function(input,options){var output,key=options.key,scope=options.scope;try{var num=Number(input);if(isNaN(num)){throw"Not a number"}else{output=num}}catch(err){try{if(input.match(/^[\+\-]?[0-9\.]+,[ ]*\ ?[\+\-]?[0-9\.]+$/)){input="["+input+"]"}output=JSON.parse(JSONize(input));if(output instanceof Array){var t1stEl=output[0];if(t1stEl.constructor==Object){}else{if(t1stEl.constructor==Array){output=output.map(function(el){return new google.maps.LatLng(el[0],el[1])})}else{if(!isNaN(parseFloat(t1stEl))&&isFinite(t1stEl)){return new google.maps.LatLng(output[0],output[1])}}}}else{if(output===Object(output)){output=getOptions(output,options)}}}catch(err2){if(input.match(/^[A-Z][a-zA-Z0-9]+\(.*\)$/)){try{var exp="new google.maps."+input;output=eval(exp)}catch(e){output=input}}else{if(input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/)){try{var matches=input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/);output=google.maps[matches[1]][matches[2]]}catch(e){output=input}}else{if(input.match(/^[A-Z]+$/)){try{var capitalizedKey=key.charAt(0).toUpperCase()+key.slice(1);if(key.match(/temperatureUnit|windSpeedUnit|labelColor/)){capitalizedKey=capitalizedKey.replace(/s$/,"");output=google.maps.weather[capitalizedKey][input]}else{output=google.maps[capitalizedKey][input]}}catch(e){output=input}}else{if(input.match(/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/)){try{output=new Date(input)}catch(e){output=input}}else{output=input}}}}}}return output};var getAttrsToObserve=function(attrs){var attrsToObserve=[];if(attrs["ng-repeat"]||attrs.ngRepeat){void (0)}else{for(var attrName in attrs){var attrValue=attrs[attrName];if(attrValue&&attrValue.match(/\{\{.*\}\}/)){console.log("setting attribute to observe",attrName,camelCase(attrName),attrValue);attrsToObserve.push(camelCase(attrName))}}}return attrsToObserve};var filter=function(attrs){var options={};for(var key in attrs){if(key.match(/^\$/)||key.match(/^ng[A-Z]/)){void (0)}else{options[key]=attrs[key]}}return options};var getOptions=function(attrs,scope){var options={};for(var key in attrs){if(attrs[key]){if(key.match(/^on[A-Z]/)){continue}else{if(key.match(/ControlOptions$/)){continue}else{if(typeof attrs[key]!=="string"){options[key]=attrs[key]}else{options[key]=toOptionValue(attrs[key],{scope:scope,key:key})}}}}}return options};var getEvents=function(scope,attrs){var events={};var toLowercaseFunc=function($1){return"_"+$1.toLowerCase()};var eventFunc=function(attrValue){var matches=attrValue.match(/([^\(]+)\(([^\)]*)\)/);var funcName=matches[1];var argsStr=matches[2].replace(/event[ ,]*/,"");var argsExpr=$parse("["+argsStr+"]");return function(event){var args=argsExpr(scope);function index(obj,i){return obj[i]}var f=funcName.split(".").reduce(index,scope);f&&f.apply(this,[event].concat(args));$timeout(function(){scope.$apply()})}};for(var key in attrs){if(attrs[key]){if(!key.match(/^on[A-Z]/)){continue}var eventName=key.replace(/^on/,"");eventName=eventName.charAt(0).toLowerCase()+eventName.slice(1);eventName=eventName.replace(/([A-Z])/g,toLowercaseFunc);var attrValue=attrs[key];events[eventName]=new eventFunc(attrValue)}}return events};var getControlOptions=function(filtered){var controlOptions={};if(typeof filtered!="object"){return false}for(var attr in filtered){if(filtered[attr]){if(!attr.match(/(.*)ControlOptions$/)){continue}var orgValue=filtered[attr];var newValue=orgValue.replace(/'/g,'"');newValue=newValue.replace(/([^"]+)|("[^"]+")/g,function($0,$1,$2){if($1){return $1.replace(/([a-zA-Z0-9]+?):/g,'"$1":')}else{return $2}});try{var options=JSON.parse(newValue);for(var key in options){if(options[key]){var value=options[key];if(typeof value==="string"){value=value.toUpperCase()}else{if(key==="mapTypeIds"){value=value.map(function(str){if(str.match(/^[A-Z]+$/)){return google.maps.MapTypeId[str.toUpperCase()]}else{return str}})}}if(key==="style"){var str=attr.charAt(0).toUpperCase()+attr.slice(1);var objName=str.replace(/Options$/,"")+"Style";options[key]=google.maps[objName][value]}else{if(key==="position"){options[key]=google.maps.ControlPosition[value]}else{options[key]=value}}}}controlOptions[attr]=options}catch(e){console.error("invald option for",attr,newValue,e,e.stack)}}}return controlOptions};return{camelCase:camelCase,filter:filter,getOptions:getOptions,getEvents:getEvents,getControlOptions:getControlOptions,toOptionValue:toOptionValue,getAttrsToObserve:getAttrsToObserve,orgAttributes:orgAttributes}};Attr2Options.$inject=["$parse","$timeout","NavigatorGeolocation","GeoCoder"];angular.module("ngMap").service("Attr2Options",Attr2Options)})();(function(){var a=function(b){return{geocode:function(d){var c=b.defer();var e=new google.maps.Geocoder();e.geocode(d,function(g,f){if(f==google.maps.GeocoderStatus.OK){c.resolve(g)}else{c.reject("Geocoder failed due to: "+f)}});return c.promise}}};a.$inject=["$q"];angular.module("ngMap").service("GeoCoder",a)})();(function(){var a=function(b){return{getCurrentPosition:function(){var c=b.defer();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(d){c.resolve(d)},function(d){console.error(d);c.reject(d)})}else{c.reject("Browser Geolocation service failed.")}return c.promise},watchPosition:function(){return"TODO"},clearWatch:function(){return"TODO"}}};a.$inject=["$q"];angular.module("ngMap").service("NavigatorGeolocation",a)})();(function(){var a=function(b){var d=function(g,h){h=h||g.getCenter();var f=b.defer();var e=new google.maps.StreetViewService();e.getPanoramaByLocation((h||g.getCenter),100,function(j,i){if(i===google.maps.StreetViewStatus.OK){f.resolve(j.location.pano)}else{f.resolve(false)}});return f.promise};var c=function(g,f){var e=new google.maps.StreetViewPanorama(g.getDiv(),{enableCloseButton:true});e.setPano(f)};return{getPanorama:d,setPanorama:c}};a.$inject=["$q"];angular.module("ngMap").service("StreetView",a)})();(function(){angular.module("ngMap").directive("bicyclingLayer",["Attr2Options",function(a){var c=a;var b=function(e,g){var f=new google.maps.BicyclingLayer(e);for(var d in g){google.maps.event.addListener(f,d,g[d])}return f};return{restrict:"E",require:"^map",link:function(j,f,i,d){var e=c.orgAttributes(f);var h=c.filter(i);var l=c.getOptions(h);var k=c.getEvents(j,h);console.log("bicycling-layer options",l,"events",k);var g=b(l,k);d.addObject("bicyclingLayers",g);d.observeAttrSetObj(e,i,g);f.bind("$destroy",function(){d.deleteObject("bicyclingLayers",g)})}}}])})();(function(){angular.module("ngMap").directive("cloudLayer",["Attr2Options",function(a){var c=a;var b=function(e,g){var f=new google.maps.weather.CloudLayer(e);for(var d in g){google.maps.event.addListener(f,d,g[d])}return f};return{restrict:"E",require:"^map",link:function(j,f,i,d){var e=c.orgAttributes(f);var h=c.filter(i);var l=c.getOptions(h);var k=c.getEvents(j,h);console.log("cloud-layer options",l,"events",k);var g=b(l,k);d.addObject("cloudLayers",g);d.observeAttrSetObj(e,i,g);f.bind("$destroy",function(){d.deleteObject("cloudLayers",g)})}}}])})();(function(){angular.module("ngMap").directive("customControl",["Attr2Options","$compile",function(b,a){var c=b;return{restrict:"E",require:"^map",link:function(k,g,j,d){var e=c.orgAttributes(g);var i=c.filter(j);var m=c.getOptions(i,k);var l=c.getEvents(k,i);console.log("custom-control options",m,"events",l);var f=g[0].parentElement.removeChild(g[0]);a(f.innerHTML.trim())(k);for(var h in l){google.maps.event.addDomListener(f,h,l[h])}d.addObject("customControls",f);k.$on("mapInitialized",function(o,p){var n=m.position;p.controls[google.maps.ControlPosition[n]].push(f)})}}}])})();(function(){var g,d,c;var f=function(h){h.preventDefault&&h.preventDefault();h.cancelBubble=true;h.stopPropagation&&h.stopPropagation()};var b=function(h){h=h||{};this.el=document.createElement("div");this.el.style.display="inline-block";this.visible=true;for(var i in h){this[i]=h[i]}};var a=function(){b.prototype=new google.maps.OverlayView();b.prototype.setContent=function(i,j){this.html=i;if(j){var l=d(i)(j);var h=l[0];var k=this;c(function(){k.content=h.innerHTML;k.el.innerHTML=k.content})}else{this.content=i;this.el.innerHTML=this.content}this.el.style.position="relative";this.el.className="custom-marker"};b.prototype.setPosition=function(i){i&&(this.position=i);if(this.getProjection()&&typeof this.position.lng=="function"){var j=this.getProjection().fromLatLngToDivPixel(this.position);var h=Math.round(j.x-(this.el.offsetWidth/2));var k=Math.round(j.y-this.el.offsetHeight-10);this.el.style.left=h+"px";this.el.style.top=k+"px"}};b.prototype.setZIndex=function(h){h&&(this.zIndex=h);this.el.style.zIndex=this.zIndex};b.prototype.setVisible=function(h){this.el.style.display=h?"inline-block":"none";this.visible=h};b.prototype.addClass=function(h){var i=this.el.className.split(" ");(i.indexOf(h)==-1)&&i.push(h);this.el.className=i.join(" ")};b.prototype.removeClass=function(i){var j=this.el.className.split(" ");var h=j.indexOf(i);(h>-1)&&j.splice(h,1);this.el.className=j.join(" ")};b.prototype.onAdd=function(){this.getPanes().overlayMouseTarget.appendChild(this.el)};b.prototype.draw=function(){this.setPosition();this.setZIndex(this.zIndex);this.setVisible(this.visible)};b.prototype.onRemove=function(){this.el.parentNode.removeChild(this.el);this.el=null}};var e=function(i,h,j){g=i;d=h;c=j;a();return{restrict:"E",require:"^map",link:function(s,n,r,k){var l=g.orgAttributes(n);var p=g.filter(r);var u=g.getOptions(p,s);var t=g.getEvents(s,p);var q=n[0].parentElement.removeChild(n[0]);console.log("custom-marker options",u);var m=new b(u);m.setContent(q.innerHTML,s);console.log("customMarker",m);console.log("custom-marker events","events");for(var o in t){google.maps.event.addDomListener(m.el,o,t[o])}k.addObject("customMarkers",m);if(!(u.position instanceof google.maps.LatLng)){k.getGeoLocation(u.position).then(function(v){m.setPosition(v)})}n.bind("$destroy",function(){k.deleteObject("customMarkers",marker)})}}};e.$inject=["Attr2Options","$compile","$timeout"];angular.module("ngMap").directive("customMarker",e)})();(function(){var a=function(d,e){if(d.panel){d.panel=document.getElementById(d.panel)||document.querySelector(d.panel)}var f=new google.maps.DirectionsRenderer(d);for(var c in e){google.maps.event.addListener(f,c,e[c])}return f};var b=function(f,e,d){var i=f;var h=new google.maps.DirectionsService();var g=function(o,j){var m=j;m.travelMode=m.travelMode||"DRIVING";var l=["origin","destination","travelMode","transitOptions","unitSystem","durationInTraffic","waypoints","optimizeWaypoints","provideRouteAlternatives","avoidHighways","avoidTolls","region"];for(var k in m){(l.indexOf(k)===-1)&&(delete m[k])}if(m.waypoints){if(m.waypoints=="[]"||m.waypoints==""){delete m.waypoints}}var n=function(p){console.log("request",p);h.route(p,function(r,q){if(q==google.maps.DirectionsStatus.OK){e(function(){o.setDirections(r)})}})};if(m.origin&&m.destination){if(m.origin=="current-location"){d.getCurrentPosition().then(function(p){m.origin=new google.maps.LatLng(p.coords.latitude,p.coords.longitude);n(m)})}else{if(m.destination=="current-location"){d.getCurrentPosition().then(function(p){m.destination=new google.maps.LatLng(p.coords.latitude,p.coords.longitude);n(m)})}else{n(m)}}}};var c=function(q,l,p,j){var k=i.orgAttributes(l);var m=i.filter(p);var s=i.getOptions(m);var r=i.getEvents(q,m);var o=i.getAttrsToObserve(k);var n=a(s,r);j.addObject("directionsRenderers",n);o.forEach(function(t){(function(u){p.$observe(u,function(v){if(u=="panel"){e(function(){var x=document.getElementById(v)||document.querySelector(v);console.log("setting ",u,"with value",x);x&&n.setPanel(x)})}else{if(s[u]!==v){var w=i.toOptionValue(v,{key:u});console.log("setting ",u,"with value",w);s[u]=w;g(n,s)}}})})(t)});q.$on("mapInitialized",function(t,u){g(n,s)});q.$on("$destroy",function(t,u){j.deleteObject("directionsRenderers",n)})};return{restrict:"E",require:"^map",link:c}};b.$inject=["Attr2Options","$timeout","NavigatorGeolocation"];angular.module("ngMap").directive("directions",b)})();(function(){angular.module("ngMap").directive("drawingManager",["Attr2Options",function(a){var b=a;return{restrict:"E",require:"^map",link:function(l,f,j,c){var d=b.orgAttributes(f);var h=b.filter(j);var m=b.getOptions(h);var i=b.getControlOptions(h);var k=b.getEvents(l,h);console.log("filtered",h,"options",m,"controlOptions",i,"events",k);var e=new google.maps.drawing.DrawingManager({drawingMode:m.drawingmode,drawingControl:m.drawingcontrol,drawingControlOptions:i.drawingControlOptions,circleOptions:m.circleoptions,markerOptions:m.markeroptions,polygonOptions:m.polygonoptions,polylineOptions:m.polylineoptions,rectangleOptions:m.rectangleoptions});var k=b.getEvents(l,h);for(var g in k){google.maps.event.addListener(e,g,k[g])}c.addObject("mapDrawingManager",e)}}}])})();(function(){angular.module("ngMap").directive("dynamicMapsEngineLayer",["Attr2Options",function(b){var c=b;var a=function(e,g){var f=new google.maps.visualization.DynamicMapsEngineLayer(e);for(var d in g){google.maps.event.addListener(f,d,g[d])}return f};return{restrict:"E",require:"^map",link:function(j,i,f,k){var e=c.filter(f);var d=c.getOptions(e);var h=c.getEvents(j,e,h);console.log("dynamic-maps-engine-layer options",d,"events",h);var g=a(d,h);k.addObject("mapsEngineLayers",g)}}}])})();(function(){angular.module("ngMap").directive("fusionTablesLayer",["Attr2Options",function(a){var c=a;var b=function(e,g){var f=new google.maps.FusionTablesLayer(e);for(var d in g){google.maps.event.addListener(f,d,g[d])}return f};return{restrict:"E",require:"^map",link:function(j,i,f,k){var e=c.filter(f);var d=c.getOptions(e);var h=c.getEvents(j,e,h);console.log("fusion-tables-layer options",d,"events",h);var g=b(d,h);k.addObject("fusionTablesLayers",g)}}}])})();(function(){angular.module("ngMap").directive("heatmapLayer",["Attr2Options","$window",function(a,b){var c=a;return{restrict:"E",require:"^map",link:function(j,i,f,k){var e=c.filter(f);var d=c.getOptions(e);d.data=b[f.data]||j[f.data];if(d.data instanceof Array){d.data=new google.maps.MVCArray(d.data)}else{throw"invalid heatmap data"}var h=new google.maps.visualization.HeatmapLayer(d);var g=c.getEvents(j,e);console.log("heatmap-layer options",h,"events",g);k.addObject("heatmapLayers",h)}}}])})();(function(){var a=function(e,d,c,f){var h=e;var g=function(j,m,l){var k;if(j.position&&!(j.position instanceof google.maps.LatLng)){delete j.position}k=new google.maps.InfoWindow(j);if(Object.keys(m).length>0){console.log("infoWindow events",m)}for(var i in m){if(i){google.maps.event.addListener(k,i,m[i])}}var n=l.html().trim();if(angular.element(n).length!=1){throw"info-window working as a template must have a container"}k.__template=n.replace(/\s?ng-non-bindable[='"]+/,"");k.__compile=function(q,o){o&&(q["this"]=o);var p=d(k.__template)(q);k.setContent(p[0]);q.$apply()};k.__open=function(q,p,o){c(function(){k.__compile(p,o);if(o&&o.getPosition){k.open(q,o)}else{if(o&&o instanceof google.maps.LatLng){k.open(q);k.setPosition(o)}else{k.open(q)}}})};return k};var b=function(p,l,o,i){l.css("display","none");var j=h.orgAttributes(l);var m=h.filter(o);var r=h.getOptions(m,p);var q=h.getEvents(p,m);console.log("infoWindow","options",r,"events",q);var n;if(r.position&&!(r.position instanceof google.maps.LatLng)){n=r.position}var k=g(r,q,l);if(n){i.getGeoLocation(n).then(function(t){k.setPosition(t);k.__open(i.map,p,t);var s=o.geoCallback;s&&f(s)(p)})}i.addObject("infoWindows",k);i.observeAttrSetObj(j,o,k);p.$on("mapInitialized",function(s,u){k.visible&&k.__open(u,p);if(k.visibleOnMarker){var t=k.visibleOnMarker;k.__open(u,p,u.markers[t])}});p.showInfoWindow=function(v,w,s){var u=i.map.infoWindows[w];var t=s?s:(this.getPosition?this:null);u.__open(i.map,p,t)};p.hideInfoWindow=p.hideInfoWindow||function(t,u){var s=i.map.infoWindows[u];s.close()}};return{restrict:"E",require:"^map",link:b}};a.$inject=["Attr2Options","$compile","$timeout","$parse"];angular.module("ngMap").directive("infoWindow",a)})();(function(){angular.module("ngMap").directive("kmlLayer",["Attr2Options",function(b){var c=b;var a=function(e,f){var g=new google.maps.KmlLayer(e);for(var d in f){google.maps.event.addListener(g,d,f[d])}return g};return{restrict:"E",require:"^map",link:function(j,g,i,d){var e=c.orgAttributes(g);var h=c.filter(i);var l=c.getOptions(h);var k=c.getEvents(j,h);console.log("kml-layer options",f,"events",k);var f=a(l,k);d.addObject("kmlLayers",f);d.observeAttrSetObj(e,i,f);g.bind("$destroy",function(){d.deleteObject("kmlLayers",f)})}}}])})();(function(){angular.module("ngMap").directive("mapData",["Attr2Options",function(a){var b=a;return{restrict:"E",require:"^map",link:function(h,g,e,i){var d=b.filter(e);var c=b.getOptions(d);var f=b.getEvents(h,d,f);console.log("map-data options",c);h.$on("mapInitialized",function(l,m){for(var k in c){if(k){var n=c[k];if(typeof h[n]==="function"){m.data[k](h[n])}else{m.data[k](n)}}}for(var j in f){if(f[j]){m.data.addListener(j,f[j])}}})}}}])})();(function(){var e,d,g,f;var b=function(l,j,i){var h=i.mapLazyLoadParams||i.mapLazyLoad;window.lazyLoadCallback=function(){console.log("Google maps script loaded:",h);e(function(){j.html(f);d(j.contents())(l)},100)};if(window.google===undefined||window.google.maps===undefined){var k=document.createElement("script");console.log("Prelinking script loaded,"+g);k.src=h+(h.indexOf("?")>-1?"&":"?")+"callback=lazyLoadCallback";document.body.appendChild(k)}else{j.html(f);d(j.contents())(l)}};var c=function(h,i){(!i.mapLazyLoad)&&console.error("requires src with map-lazy-load");f=h.html();g=i.mapLazyLoad;if(document.querySelector('script[src="'+g+(g.indexOf("?")>-1?"&":"?")+'callback=lazyLoadCallback"]')){return false}h.html("");return{pre:b}};var a=function(h,i){d=h,e=i;return{compile:c}};a.$inject=["$compile","$timeout"];angular.module("ngMap").directive("mapLazyLoad",a)})();(function(){angular.module("ngMap").directive("mapType",["Attr2Options","$window",function(a,b){var c=a;return{restrict:"E",require:"^map",link:function(g,f,d,i){var h=d.name,j;if(!h){throw"invalid map-type name"}if(d.object){var e=g[d.object]?g:b;j=e[d.object];if(typeof j=="function"){j=new j()}}if(!j){throw"invalid map-type object"}g.$on("mapInitialized",function(k,l){l.mapTypes.set(h,j)});i.addObject("mapTypes",j)}}}])})();(function(){function a(d,c){var e;if(d.currentStyle){e=d.currentStyle[c]}else{if(window.getComputedStyle){e=document.defaultView.getComputedStyle(d,null).getPropertyValue(c)}}return e}var b=function(e,d,f){var g=e;var c=function(r,m,q,h){var j=g.orgAttributes(m);r.google=google;var k=document.createElement("div");k.style.width="100%";k.style.height="100%";m.prepend(k);if(q.defaultStyle!=="false"){if(a(m[0],"display")!="block"){m.css("display","block")}if(a(m[0],"height").match(/^(0|auto)/)){m.css("height","300px")}}m[0].addEventListener("dragstart",function(t){t.preventDefault();return false});var i=function(v,x){var w=new google.maps.Map(k,{});w.markers={};w.shapes={};d(function(){google.maps.event.trigger(w,"resize")});v.zoom=v.zoom||15;var t=v.center;if(!t){v.center=new google.maps.LatLng(0,0)}else{if(!(t instanceof google.maps.LatLng)){delete v.center;h.getGeoLocation(t).then(function(z){w.setCenter(z);var y=q.geoCallback;y&&f(y)(r)},function(y){w.setCenter(s.geoFallbackCenter)})}}w.setOptions(v);for(var u in x){if(u){google.maps.event.addListener(w,u,x[u])}}h.observeAttrSetObj(j,q,w);h.map=w;h.addObjects(h._objects);r.map=w;r.map.scope=r;google.maps.event.addListenerOnce(w,"idle",function(){r.$emit("mapInitialized",w);if(q.zoomToIncludeMarkers){h.zoomToIncludeMarkers();if(q.zoomToIncludeMarkers=="auto"){r.$on("objectChanged",function(y,z){z[0]=="markers"&&h.zoomToIncludeMarkers()})}}})};var n=g.filter(q);var s=g.getOptions(n,r);var p=g.getControlOptions(n);var l=angular.extend(s,p);var o=g.getEvents(r,n);console.log("filtered",n,"mapOptions",l,"mapEvents",o);if(q.initEvent){r.$on(q.initEvent,function(){!h.map&&i(l,o)})}else{i(l,o)}};return{restrict:"AE",controller:"MapController",link:c}};angular.module("ngMap").directive("map",["Attr2Options","$timeout","$parse",b])})();(function(){var a=function(e,d,c,g,f){var i=f;var h=this;var b=function(k,l,j){k.$observe(l,function(n){if(n){console.log("observing ",j,l,n);var m=i.camelCase("set-"+l);var o=i.toOptionValue(n,{key:l});console.log("setting ",j,l,"with value",o);if(j[m]){if(l.match(/center|position/)&&typeof o=="string"){h.getGeoLocation(o).then(function(p){j[m](p)})}else{j[m](o)}}}})};this.map=null;this._objects=[];this.addObject=function(l,k){if(this.map){this.map[l]=this.map[l]||{};var j=Object.keys(this.map[l]).length;this.map[l][k.id||j]=k;if(l!="infoWindows"&&k.setMap){k.setMap&&k.setMap(this.map)}if(k.centered&&k.position){this.map.setCenter(k.position)}e.$emit("objectChanged",[l,this.map[l]])}else{k.groupName=l;this._objects.push(k)}};this.deleteObject=function(m,k){if(k.map){var l=k.map[m];for(var j in l){l[j]===k&&(delete l[j])}k.map&&k.setMap&&k.setMap(null);e.$emit("objectChanged",[m,this.map[m]])}};this.addObjects=function(k){for(var j=0;j<k.length;j++){var l=k[j];if(l instanceof google.maps.Marker){this.addObject("markers",l)}else{if(l instanceof google.maps.Circle||l instanceof google.maps.Polygon||l instanceof google.maps.Polyline||l instanceof google.maps.Rectangle||l instanceof google.maps.GroundOverlay){this.addObject("shapes",l)}else{this.addObject(l.groupName,l)}}}};this.getGeoLocation=function(k){var j=d.defer();if(!k||k.match(/^current/i)){c.getCurrentPosition().then(function(l){var o=l.coords.latitude;var m=l.coords.longitude;var n=new google.maps.LatLng(o,m);j.resolve(n)},function(l){j.reject(l)})}else{g.geocode({address:k}).then(function(l){j.resolve(l[0].geometry.location)},function(l){j.reject(l)})}return j.promise};this.observeAttrSetObj=function(j,k,n){var m=i.getAttrsToObserve(j);if(Object.keys(m).length){console.log(n,"attributes to observe",m)}for(var l=0;l<m.length;l++){b(k,m[l],n)}};this.zoomToIncludeMarkers=function(){var k=new google.maps.LatLngBounds();for(var j in this.map.markers){k.extend(this.map.markers[j].getPosition())}this.map.fitBounds(k)}};a.$inject=["$scope","$q","NavigatorGeolocation","GeoCoder","Attr2Options"];angular.module("ngMap").controller("MapController",a)})();(function(){angular.module("ngMap").directive("mapsEngineLayer",["Attr2Options",function(a){var c=a;var b=function(e,g){var f=new google.maps.visualization.MapsEngineLayer(e);for(var d in g){google.maps.event.addListener(f,d,g[d])}return f};return{restrict:"E",require:"^map",link:function(j,i,f,k){var e=c.filter(f);var d=c.getOptions(e);var h=c.getEvents(j,e,h);console.log("maps-engine-layer options",d,"events",h);var g=b(d,h);k.addObject("mapsEngineLayers",g)}}}])})();(function(){var b=function(f,h){var d;if(f.icon instanceof Object){if((""+f.icon.path).match(/^[A-Z_]+$/)){f.icon.path=google.maps.SymbolPath[f.icon.path]}for(var g in f.icon){var c=f.icon[g];if(g=="anchor"||g=="origin"){f.icon[g]=new google.maps.Point(c[0],c[1])}else{if(g=="size"||g=="scaledSize"){f.icon[g]=new google.maps.Size(c[0],c[1])}}}}if(!(f.position instanceof google.maps.LatLng)){f.position=new google.maps.LatLng(0,0)}d=new google.maps.Marker(f);if(Object.keys(h).length>0){console.log("markerEvents",h)}for(var e in h){if(e){google.maps.event.addListener(d,e,h[e])}}return d};var a=function(d,e){var f=d;var c=function(p,k,n,g){var i=f.orgAttributes(k);var l=f.filter(n);var h=f.getOptions(l,p);var o=f.getEvents(p,l);console.log("marker options",h,"events",o);var m;if(!(h.position instanceof google.maps.LatLng)){m=h.position}var j=b(h,o);g.addObject("markers",j);if(m){g.getGeoLocation(m).then(function(r){j.setPosition(r);h.centered&&j.map.setCenter(r);var q=n.geoCallback;q&&e(q)(p)})}g.observeAttrSetObj(i,n,j);k.bind("$destroy",function(){g.deleteObject("markers",j)})};return{restrict:"E",require:"^map",link:c}};a.$inject=["Attr2Options","$parse"];angular.module("ngMap").directive("marker",a)})();(function(){angular.module("ngMap").directive("overlayMapType",["Attr2Options","$window",function(a,b){var c=a;return{restrict:"E",require:"^map",link:function(h,g,e,i){var j;var d=e.initMethod||"insertAt";if(e.object){var f=h[e.object]?h:b;j=f[e.object];if(typeof j=="function"){j=new j()}}if(!j){throw"invalid map-type object"}h.$on("mapInitialized",function(k,m){if(d=="insertAt"){var l=parseInt(e.index,10);m.overlayMapTypes.insertAt(l,j)}else{if(d=="push"){m.overlayMapTypes.push(j)}}});i.addObject("overlayMapTypes",j)}}}])})();(function(){var a=function(d,c){var e=d;var b=function(m,i,l,g){var k=e.filter(l);var o=e.getOptions(k);var n=e.getEvents(m,k);console.log("autocomplete options",o,"events",n);var f=new google.maps.places.Autocomplete(i[0],o);for(var j in n){google.maps.event.addListener(f,j,n[j])}var h=function(){c(function(){g&&g.$setViewValue(i.val())},100)};google.maps.event.addListener(f,"place_changed",h);i[0].addEventListener("change",h);l.$observe("types",function(p){if(p){console.log("observing types",p);var q=e.toOptionValue(p,{key:"types"});console.log("setting types with value",q);f.setTypes(q)}})};return{restrict:"A",require:"?ngModel",link:b}};a.$inject=["Attr2Options","$timeout"];angular.module("ngMap").directive("placesAutoComplete",a)})();(function(){var b=function(d){return new google.maps.LatLngBounds(d[0],d[1])};var c=function(n,m){var k;var l=n.name;delete n.name;console.log("shape",l,"options",n,"events",m);if(n.icons){for(var h=0;h<n.icons.length;h++){var g=n.icons[h];if(g.icon.path.match(/^[A-Z_]+$/)){g.icon.path=google.maps.SymbolPath[g.icon.path]}}}switch(l){case"circle":if(!(n.center instanceof google.maps.LatLng)){n.center=new google.maps.LatLng(0,0)}k=new google.maps.Circle(n);break;case"polygon":k=new google.maps.Polygon(n);break;case"polyline":k=new google.maps.Polyline(n);break;case"rectangle":if(n.bounds){n.bounds=b(n.bounds)}k=new google.maps.Rectangle(n);break;case"groundOverlay":case"image":var f=n.url;var e=b(n.bounds);var d={opacity:n.opacity,clickable:n.clickable,id:n.id};k=new google.maps.GroundOverlay(f,e,d);break}for(var j in m){if(m[j]){google.maps.event.addListener(k,j,m[j])}}return k};var a=function(e,f){var g=e;var d=function(r,m,q,h){var i=g.orgAttributes(m);var o=g.filter(q);var j=g.getOptions(o);var l=g.getEvents(r,o);var p,k;k=j.name;if(!(j.center instanceof google.maps.LatLng)){p=j.center}var n=c(j,l);h.addObject("shapes",n);if(p&&k=="circle"){h.getGeoLocation(p).then(function(t){n.setCenter(t);n.centered&&n.map.setCenter(t);var s=q.geoCallback;s&&f(s)(r)})}h.observeAttrSetObj(i,q,n);m.bind("$destroy",function(){h.deleteObject("shapes",n)})};return{restrict:"E",require:"^map",link:d}};a.$inject=["Attr2Options","$parse"];angular.module("ngMap").directive("shape",a)})();(function(){var a=function(d){var e=d;var b=function(k,h,j){var i,f;if(h.container){f=document.getElementById(h.container);f=f||document.querySelector(h.container)}if(f){i=new google.maps.StreetViewPanorama(f,h)}else{i=k.getStreetView();i.setOptions(h)}for(var g in j){g&&google.maps.event.addListener(i,g,j[g])}return i};var c=function(n,h,m,f){var g=e.orgAttributes(h);var j=e.filter(m);var o=e.getOptions(j);var k=e.getControlOptions(j);var l=angular.extend(o,k);var i=e.getEvents(n,j);console.log("street-view-panorama","options",l,"events",i);n.$on("mapInitialized",function(p,s){var q=b(s,l,i);s.setStreetView(q);(!q.getPosition())&&q.setPosition(s.getCenter());google.maps.event.addListener(q,"position_changed",function(){if(q.getPosition()!==s.getCenter()){s.setCenter(q.getPosition())}});var r=google.maps.event.addListener(s,"center_changed",function(){q.setPosition(s.getCenter());google.maps.event.removeListener(r)})})};return{restrict:"E",require:"^map",link:c}};a.$inject=["Attr2Options"];angular.module("ngMap").directive("streetViewPanorama",a)})();(function(){angular.module("ngMap").directive("trafficLayer",["Attr2Options",function(a){var c=a;var b=function(e,g){var f=new google.maps.TrafficLayer(e);for(var d in g){google.maps.event.addListener(f,d,g[d])}return f};return{restrict:"E",require:"^map",link:function(j,f,i,d){var e=c.orgAttributes(f);var h=c.filter(i);var l=c.getOptions(h);var k=c.getEvents(j,h);console.log("traffic-layer options",l,"events",k);var g=b(l,k);d.addObject("trafficLayers",g);d.observeAttrSetObj(e,i,g);f.bind("$destroy",function(){d.deleteObject("trafficLayers",g)})}}}])})();(function(){angular.module("ngMap").directive("transitLayer",["Attr2Options",function(a){var c=a;var b=function(e,g){var f=new google.maps.TransitLayer(e);for(var d in g){google.maps.event.addListener(f,d,g[d])}return f};return{restrict:"E",require:"^map",link:function(j,f,i,d){var e=c.orgAttributes(f);var h=c.filter(i);var l=c.getOptions(h);var k=c.getEvents(j,h);console.log("transit-layer options",l,"events",k);var g=b(l,k);d.addObject("transitLayers",g);d.observeAttrSetObj(e,i,g);f.bind("$destroy",function(){d.deleteObject("transitLayers",g)})}}}])})();(function(){angular.module("ngMap").directive("weatherLayer",["Attr2Options",function(a){var c=a;var b=function(e,g){var f=new google.maps.weather.WeatherLayer(e);for(var d in g){google.maps.event.addListener(f,d,g[d])}return f};return{restrict:"E",require:"^map",link:function(j,f,i,d){var e=c.orgAttributes(f);var h=c.filter(i);var l=c.getOptions(h);var k=c.getEvents(j,h);console.log("weather-layer options",l,"events",k);var g=b(l,k);d.addObject("weatherLayers",g);d.observeAttrSetObj(e,i,g);f.bind("$destroy",function(){d.deleteObject("weatherLayers",g)})}}}])})();