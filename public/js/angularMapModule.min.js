function parseGeoPoints(c,a,b){return{parse:function(i,e){var h=/([0-9-.]+),([0-9-.]+)/,g,f={},d=a.defer();if(h.test(i)&&!e){g=i.match(h);f.lat=parseFloat(g[1]);f.lng=parseFloat(g[2]);d.resolve(f)}else{c.get("https://maps.google.com/maps/api/geocode/json?address="+i+"&sensor=false").success(function(j){j.address=j.results[0].formatted_address;j.lat=j.results[0].geometry.location.lat;j.lng=j.results[0].geometry.location.lng;d.resolve(j)}).error(function(k,j){b.error(k,j)})}return d.promise}}}function directionsDisplay(a){return{calculate:function(d,c,b,f){var g=b||"DRIVING",e=f||"Directions request failed";a.directionsService.route({origin:d,destination:c,travelMode:google.maps.TravelMode[g]},function(i,h){if(h===google.maps.DirectionsStatus.OK){a.directionsDisplay.setDirections(i)}else{window.alert(e)}})}}}function map(b,a){return{restrict:"E",scope:{mapPoints:"@points",mapHeight:"@height",mapWidth:"@width",mapZoom:"@zoom"},template:function(d,c){return'<div id="'+c.id+'"></div>'},transclude:true,link:function(k,g,h,c,d){a.markers=[];a.infowindow={};a.infowindowsTemplate={};a.directionsService=new google.maps.DirectionsService;a.directionsDisplay=new google.maps.DirectionsRenderer;var i=k.mapHeight||"300px",e=k.mapWidth||"500px",j=k.mapZoom||7,f=document.getElementById(h.id);f.style.display="block";f.style.height=i;f.style.width=e;b.parse(k.mapPoints).then(function(l){a.map=new google.maps.Map(f,{center:{lat:l.lat,lng:l.lng},scrollwheel:true,zoom:j});a.directionsDisplay.setMap(a.map);g.append(d())})}}}function marker(b,a,c){return{restrict:"E",transclude:true,link:function(h,g,f,i,e){function d(){b.parse(f.points).then(function(n){var j=new google.maps.Marker({position:{lat:n.lat,lng:n.lng},map:a.map});if(f.info==="true"){var m=new google.maps.InfoWindow(),l=e(),k=h.$eval(c(l[1].innerHTML));m.setContent(k);j.addListener("click",function(o){m.open(a.map,j)})}a.markers.push(j)})}f.$observe("points",d)}}}function autocompletebox(a){return{restrict:"AEC",scope:{mapOptions:"@options"},link:function(e,d,c,f){var b=e.$eval(e.mapOptions)||{};a.InitAutoCompleteBox=new google.maps.places.Autocomplete(d[0],b)}}}function directionspanel(a){return{restrict:"AEC",link:function(d,c,b,e){a.directionsDisplay.setPanel(c[0])}}}angular.module("maps",[]).factory("parseGeoPoints",["$http","$q","$log",parseGeoPoints]).factory("directionsDisplay",["$rootScope",directionsDisplay]).directive("map",["parseGeoPoints","$rootScope",map]).directive("marker",["parseGeoPoints","$rootScope","$interpolate",marker]).directive("autocompletebox",["$rootScope",autocompletebox]).directive("directionspanel",["$rootScope",directionspanel]);